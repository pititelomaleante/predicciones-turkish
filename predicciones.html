<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Predicciones Deportivas</title>
  <!-- Cargar Supabase desde CDN -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
</head>
<body>
  <h1>Mis Predicciones Deportivas</h1>
  <div id="predictions-content">Cargando...</div>

  <script>
    //  Configuraci贸n
    const SUPABASE_URL = 'https://xxbkbttwzkmbiiuqrdlo.supabase.co';
    const SUPABASE_ANON_KEY = 'sb_publishable_YsH66sLWAARNM6gQ2P8lSw_Ngt2pCod';

    // Iniciar cuando la p谩gina cargue
    document.addEventListener('DOMContentLoaded', async () => {
      const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

      try {
        const {  { user } } = await supabase.auth.getUser();

        if (!user) {
          document.getElementById('predictions-content').innerHTML = 
            `<p>Debes iniciar sesi贸n para ver predicciones. <a href="index.html">Reg铆strate o inicia sesi贸n</a>.</p>`;
          return;
        }

        // Verificar si est谩 aprobado
        const { data, error } = await supabase
          .from('users')
          .select('is_approved')
          .eq('id', user.id)
          .single();

        if (error || !data || !data.is_approved) {
          document.getElementById('predictions-content').innerHTML = 
            `<p>Acceso no autorizado. Tu cuenta a煤n no ha sido aprobada por el administrador.</p>`;
          return;
        }

        // Cargar predicciones
        const {  matches } = await supabase
          .from('matches')
          .select('*')
          .order('match_date', { ascending: false });

        if (matches.length === 0) {
          document.getElementById('predictions-content').innerHTML = 
            `<p>No hay predicciones disponibles a煤n.</p>`;
          return;
        }

        // Mostrar predicciones
        let html = '<h2>ltimas predicciones</h2>';
        matches.forEach(match => {
          const date = new Date(match.match_date).toLocaleDateString('es-ES');
          html += `
            <div style="border: 1px solid #ccc; padding: 12px; margin: 12px 0; border-radius: 6px;">
              <h3>${match.home_team} vs ${match.away_team} (${match.sport})</h3>
              <p><strong>Fecha:</strong> ${date}</p>
              <p><strong>Predicci贸n:</strong> ${match.prediction}</p>
              <p><strong>Raz贸n:</strong> ${match.reason}</p>
            </div>
          `;
        });

        document.getElementById('predictions-content').innerHTML = html;

      } catch (err) {
        document.getElementById('predictions-content').innerHTML = 
          `<p style="color:red;">Error al cargar predicciones: ${err.message}</p>`;
      }
    });
  </script>
</body>
</html>
