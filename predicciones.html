<script>
  const SUPABASE_URL = 'https://xxbkbttwzkmbiiuqrdlo.supabase.co';
  const SUPABASE_ANON_KEY = 'sb_publishable_YsH66sLWAARNM6gQ2P8lSw_Ngt2pCod';

  async function loadPredictions() {
    try {
      const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

      // 1. Verificar usuario
      const { data } = await supabase.auth.getUser();
      const user = data?.user;
      if (!user) {
        document.getElementById('p').innerHTML = '‚ùå No has iniciado sesi√≥n.';
        return;
      }

      // 2. Verificar aprobaci√≥n
      const { data: userData, error: authError } = await supabase
        .from('users')
        .select('is_approved')
        .eq('id', user.id)
        .single();

      if (authError || !userData || !userData.is_approved) {
        document.getElementById('p').innerHTML = '‚ùå Acceso no autorizado.';
        return;
      }

      // 3. Cargar predicciones ‚Äî CORRECTO
      const { data: matches, error: matchError } = await supabase
        .from('matches')
        .select('*');

      if (matchError) throw matchError;
      if (!matches || matches.length === 0) {
        document.getElementById('p').innerHTML = '‚ö†Ô∏è No hay predicciones a√∫n.';
        return;
      }

      // 4. Mostrar
      let html = '<h2>Predicciones:</h2>';
      matches.forEach(m => {
        html += `<p><strong>${m.home_team} vs ${m.away_team}</strong> ‚Üí ${m.prediction}</p>`;
      });
      document.getElementById('p').innerHTML = html;

    } catch (err) {
      document.getElementById('p').innerHTML = `üí• Error: ${err.message}`;
    }
  }

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', loadPredictions);
  } else {
    loadPredictions();
  }
</script>
