<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Predicciones</title>
</head>
<body>
  <h1>Mis Predicciones</h1>
  <div id="p">Cargando...</div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <script>
    const SUPABASE_URL = 'https://xxbkbttwzkmbiiuqrdlo.supabase.co';
    const SUPABASE_ANON_KEY = 'sb_publishable_YsH66sLWAARNM6gQ2P8lSw_Ngt2pCod';

    async function loadPredictions() {
      try {
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        // Obtener usuario
        const { data } = await supabase.auth.getUser();
        const user = data.user;

        if (!user) {
          document.getElementById('p').innerHTML = '‚ùå No has iniciado sesi√≥n.';
          return;
        }

        // Verificar aprobaci√≥n
        const { data: userData, error } = await supabase
          .from('users')
          .select('is_approved')
          .eq('id', user.id)
          .single();

        if (error || !userData || !userData.is_approved) {
          document.getElementById('p').innerHTML = '‚ùå Acceso no autorizado.';
          return;
        }

        // Cargar predicciones
        const {  matches } = await supabase.from('matches').select('*');
        if (!matches || matches.length === 0) {
          document.getElementById('p').innerHTML = '‚ö†Ô∏è No hay predicciones a√∫n.';
          return;
        }

        let html = '<h2>Predicciones:</h2>';
        matches.forEach(m => {
          html += `<p><strong>${m.home_team} vs ${m.away_team}</strong> ‚Üí ${m.prediction}</p>`;
        });
        document.getElementById('p').innerHTML = html;

      } catch (err) {
        document.getElementById('p').innerHTML = 'üí• Error: ' + err.message;
      }
    }

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', loadPredictions);
    } else {
      loadPredictions();
    }
  </script>
</body>
</html>
